<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Retrieving Longitudinal and Repeating Structures --DRAFT • REDCapR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Retrieving Longitudinal and Repeating Structures --DRAFT">
<meta property="og:description" content="REDCapR">
<meta property="og:image" content="https://ouhscbbmc.github.io/REDCapR/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">REDCapR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.9003</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/OuhscBbmc/REDCapR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Retrieving Longitudinal and Repeating Structures –DRAFT</h1>
                        <h4 data-toc-skip class="author">Will Beasley</h4>
            <address class="author_afil">
      Biomedical &amp; Behavior Methodology Core, OUHSC Pediatrics<br><h4 data-toc-skip class="author">Stephan or Rich?</h4>
            <address class="author_afil">
      CHOP<br><small class="dont-index">Source: <a href="https://github.com/OuhscBbmc/REDCapR/blob/HEAD/vignettes/longitudinal-and-repeating.Rmd" class="external-link"><code>vignettes/longitudinal-and-repeating.Rmd</code></a></small>
      <div class="hidden name"><code>longitudinal-and-repeating.Rmd</code></div>

    </address>
</address>
</div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>If your REDCap project is longitudinal or contains repeating measures, a single call to the API (or a single export through the browser) will return a dataset that is not readily analyzed. Instead, the dataset will resemble Table 5. This isn’t because of a software bug, but because you haven’t told the software how you would like it structured. There isn’t a great way to jam this multidimensional space into a rectangle of points. Our advice for querying REDCap is the same as querying any database system: request datasets that have a natural “grain” and assemble them as to best fit your analyses.</p>
<p>If your project is not longitudinal and has not repeating measures, you can stop reading and simply call REDCapR’s <a href="https://ouhscbbmc.github.io/REDCapR/reference/redcap_read.html"><code>redcap_read()</code></a>.</p>
</div>
<div class="section level2">
<h2 id="illustration-of-how-data-points-are-structured">Illustration of How Data Points are Structured<a class="anchor" aria-label="anchor" href="#illustration-of-how-data-points-are-structured"></a>
</h2>
<p>Suppose you have two patients (<em>i.e.</em>, “1” and “2”) with three intake variables (<em>i.e.</em>, <code>height</code>, <code>weight</code>, and <code>bmi</code>). If you record this on a piece of paper, it would probably look like Table 1. The table’s <em>grain</em> is “patient”, because each row represents a distinct patient. Understanding the grain of each structure below will help you understand how the structures are re-expressions of the same set of observations.</p>
<p><strong>Table 1: patient grain</strong> is the most natural presentation of the six initial observations.</p>
<table class="table">
<thead><tr class="header">
<th align="right"><code>pt</code></th>
<th align="right"><code>height</code></th>
<th align="right"><code>weight</code></th>
<th align="right"><code>bmi</code></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1.0</td>
<td align="right">11.0</td>
<td align="right">111.0</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2.0</td>
<td align="right">22.0</td>
<td align="right">222.0</td>
</tr>
</tbody>
</table>
<p>This patient-grain structure is how the data points are most comfortably inputted by humans into REDCap, and it is the default when exported through the browser and API. However it is stored differently under the hood.</p>
<p>REDCap’s flexibility is a driver of its success. Once a research team learns REDCap, it can reuse the knowledge to capture anything from qqq to qqq. But to achieve this flexibility in the world of REDCap and EMRs, data are stored along the observation grain. In computer science, this is commonly called an EAV structure (which stands for entity-attribute-value). The patient’s ID is the entity, the variable type is the attribute, and the observed point is the value. It can also be thought of as a “key-value store” nested within a patient (where “key” is a synonym of “attribute”). Notice that the two wider rows have morphed into six skinnier rows –one row per observation. If you are a curious database administrator, peek at the the structure and rows of the <code>redcap_data</code> table. It is the most important table in the database.</p>
<p><strong>Table 2: observation grain</strong> is how REDCap and EMR databases store observations in their underlying table. It is a simplification of <code>redcap_data</code>, the heart of the database.</p>
<table class="table">
<thead><tr class="header">
<th align="right"><code>pt</code></th>
<th align="left"><code>key</code></th>
<th align="right"><code>value</code></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">height</td>
<td align="right">1.0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">weight</td>
<td align="right">11.0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">bmi</td>
<td align="right">111.0</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">height</td>
<td align="right">2.0</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">weight</td>
<td align="right">22.0</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">bmi</td>
<td align="right">222.0</td>
</tr>
</tbody>
</table>
<p>If the investigation gains a longitudinal or repeating component, it becomes necessary to include the dimension of time. Suppose the protocols specifies five time points; the blood pressure instrument is captured at times 1, 2, &amp; 3 while the laboratory instrument is captured at times 1 &amp; 2. If you record this stage on paper, it will likely resemble Tables 3a &amp; 3b: one for vitals and one for labs.</p>
<p><strong>Table 3a: patient-time grain for <code>blood_pressure</code> instrument</strong> is how</p>
<table class="table">
<thead><tr class="header">
<th align="right"><code>pt</code></th>
<th align="right"><code>time</code></th>
<th align="right"><code>sbp</code></th>
<th align="right"><code>dbp</code></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1.1</td>
<td align="right">11.1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1.2</td>
<td align="right">11.2</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">3</td>
<td align="right">1.3</td>
<td align="right">11.3</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">2.1</td>
<td align="right">22.1</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">2</td>
<td align="right">2.2</td>
<td align="right">22.2</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">3</td>
<td align="right">2.3</td>
<td align="right">22.3</td>
</tr>
</tbody>
</table>
<p><strong>Table 3b: patient-time grain for <code>laboratory</code> instrument</strong> is how</p>
<table class="table">
<thead><tr class="header">
<th align="right"><code>pt</code></th>
<th align="right"><code>time</code></th>
<th align="right"><code>lab</code></th>
<th align="right"><code>dose</code></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">aa1</td>
<td align="right">1.1 mg</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2</td>
<td align="right">aa2</td>
<td align="right">1.2 mg</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">1</td>
<td align="right">bb1</td>
<td align="right">2.1 mg</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2</td>
<td align="right">bb2</td>
<td align="right">2.2 mg</td>
</tr>
</tbody>
</table>
<p>When these measurements are added to REDCap’s observation table, it resembles Table 4. Two new columns are required to uniquely distinguish the instrument and its ordinal position. Notice the first six rows are copied from Table 2; they have empty values for the repeating structure.</p>
<p><strong>Table 4: observation grain for <code>intake</code>, <code>blood_pressure</code>, and <code>laboratory</code> instruments</strong> is how…</p>
<table class="table">
<thead><tr class="header">
<th align="right"><code>pt</code></th>
<th align="right">
<code>repeat</code><br><code>instrument</code>
</th>
<th align="right">
<code>repeat</code><br><code>instance</code>
</th>
<th align="right"><code>key</code></th>
<th align="right"><code>value</code></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">height</td>
<td align="right">1.0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">weight</td>
<td align="right">11.0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">bmi</td>
<td align="right">111.0</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">height</td>
<td align="right">2.0</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">weight</td>
<td align="right">22.0</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">bmi</td>
<td align="right">222.0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">blood_pressure</td>
<td align="right">1</td>
<td align="right">sbp</td>
<td align="right">1.1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">blood_pressure</td>
<td align="right">1</td>
<td align="right">dbp</td>
<td align="right">11.1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">blood_pressure</td>
<td align="right">2</td>
<td align="right">sbp</td>
<td align="right">1.2</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">blood_pressure</td>
<td align="right">2</td>
<td align="right">dbp</td>
<td align="right">11.2</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">blood_pressure</td>
<td align="right">3</td>
<td align="right">sbp</td>
<td align="right">1.3</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">blood_pressure</td>
<td align="right">3</td>
<td align="right">dbp</td>
<td align="right">11.3</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">laboratory</td>
<td align="right">1</td>
<td align="right">lab</td>
<td align="right">aa1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">laboratory</td>
<td align="right">1</td>
<td align="right">conc</td>
<td align="right">1.1 ppm</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">laboratory</td>
<td align="right">2</td>
<td align="right">lab</td>
<td align="right">aa2</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">laboratory</td>
<td align="right">2</td>
<td align="right">conc</td>
<td align="right">1.2 ppm</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">blood_pressure</td>
<td align="right">1</td>
<td align="right">sbp</td>
<td align="right">2.1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">blood_pressure</td>
<td align="right">1</td>
<td align="right">dbp</td>
<td align="right">22.1</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">blood_pressure</td>
<td align="right">2</td>
<td align="right">sbp</td>
<td align="right">2.2</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">blood_pressure</td>
<td align="right">2</td>
<td align="right">dbp</td>
<td align="right">22.2</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">blood_pressure</td>
<td align="right">3</td>
<td align="right">sbp</td>
<td align="right">2.3</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">blood_pressure</td>
<td align="right">3</td>
<td align="right">dbp</td>
<td align="right">22.3</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">laboratory</td>
<td align="right">1</td>
<td align="right">lab</td>
<td align="right">bb1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">laboratory</td>
<td align="right">1</td>
<td align="right">conc</td>
<td align="right">2.1 ppm</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">laboratory</td>
<td align="right">2</td>
<td align="right">lab</td>
<td align="right">bb2</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">laboratory</td>
<td align="right">2</td>
<td align="right">conc</td>
<td align="right">2.2 ppm</td>
</tr>
</tbody>
</table>
<p>As mentioned above, there isn’t a universally good way to coerce Tables 1, 3a, and 3b into a single rectangle because the rows represent different things. Or from REDCap’s perspective, there’s not a good transformation of <code>redcap_data</code> (<em>i.e.</em>, Table 4) that is appropriate for most statistical programs.</p>
<p>When forced to combine the different entities, the best option is probably Table 5. We call this a “block dataset”, borrowing from linear algebra’s term <a href="https://mathworld.wolfram.com/BlockMatrix.html" class="external-link">block matrix</a>. You can see the mishmash of tables masquerading as a unified dataset. However it’s obvious the rows lack the conceptual coherency of Tables 1, 3a, &amp; 3b.</p>
<p><strong>Table 5: mishmashed grain</strong> is how the points are returned from REDCap if you request the data in a single call.</p>
<table class="table">
<thead><tr class="header">
<th><code>pt</code></th>
<th align="center">
<code>repeat</code><br><code>instrument</code>
</th>
<th align="right">
<code>repeat</code><br><code>instance</code>
</th>
<th align="right"><code>height</code></th>
<th align="right"><code>weight</code></th>
<th align="right"><code>bmi</code></th>
<th align="right"><code>sbp</code></th>
<th align="right"><code>dbp</code></th>
<th align="right"><code>lab</code></th>
<th align="right"><code>conc</code></th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td align="center">–</td>
<td align="right">–</td>
<td align="right">1.0</td>
<td align="right">11.0</td>
<td align="right">111.0</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
</tr>
<tr class="even">
<td>1</td>
<td align="center">blood_pressure</td>
<td align="right">1</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">1.1</td>
<td align="right">11.1</td>
<td align="right">–</td>
<td align="right">–</td>
</tr>
<tr class="odd">
<td>1</td>
<td align="center">blood_pressure</td>
<td align="right">2</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">1.2</td>
<td align="right">11.2</td>
<td align="right">–</td>
<td align="right">–</td>
</tr>
<tr class="even">
<td>1</td>
<td align="center">blood_pressure</td>
<td align="right">3</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">1.3</td>
<td align="right">11.3</td>
<td align="right">–</td>
<td align="right">–</td>
</tr>
<tr class="odd">
<td>1</td>
<td align="center">laboratory</td>
<td align="right">1</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">aa1</td>
<td align="right">1.1 ppm</td>
</tr>
<tr class="even">
<td>1</td>
<td align="center">laboratory</td>
<td align="right">2</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">aa2</td>
<td align="right">1.2 ppm</td>
</tr>
<tr class="odd">
<td>2</td>
<td align="center">–</td>
<td align="right">–</td>
<td align="right">2.0</td>
<td align="right">22.0</td>
<td align="right">222.0</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
</tr>
<tr class="even">
<td>2</td>
<td align="center">blood_pressure</td>
<td align="right">1</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">2.1</td>
<td align="right">22.1</td>
<td align="right">–</td>
<td align="right">–</td>
</tr>
<tr class="odd">
<td>2</td>
<td align="center">blood_pressure</td>
<td align="right">2</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">2.2</td>
<td align="right">22.2</td>
<td align="right">–</td>
<td align="right">–</td>
</tr>
<tr class="even">
<td>2</td>
<td align="center">blood_pressure</td>
<td align="right">3</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">2.3</td>
<td align="right">22.3</td>
<td align="right">–</td>
<td align="right">–</td>
</tr>
<tr class="odd">
<td>2</td>
<td align="center">laboratory</td>
<td align="right">1</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">bb1</td>
<td align="right">2.1 ppm</td>
</tr>
<tr class="even">
<td>2</td>
<td align="center">laboratory</td>
<td align="right">2</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">bb2</td>
<td align="right">2.2 ppm</td>
</tr>
</tbody>
</table>
<p>A block dataset is not inherently bad. After all, Table 5 can be unambiguously transformed to and from Table 4.</p>
<p>Table 5’s primary limitation is that a block dataset is not understood by analysis software used in conventional medical research. At best, the dataset always will require additional preparation. At worst, the analyst will model the rows inappropriately, which will produce misleading conclusions.</p>
<p>Table 5’s secondary limitation is inefficiency. The empty cells aren’t computationally free. Every cell must be queried from the database and concatenated in REDCap’s web server in order to return Table 5 in the plain-text csv, json, or xml format. In our simple example, more than half of the block dataset’s cells are wasted. The emptiness frequently exceeds 90% in real-world REDCap projects (because they tend to have many more variables and repeating instances). The emptiness always exceeds 99.9% in real-world EMRs.</p>
<p>For this reason, REDCap and EMR design their observation table to resemble the computational structure of a <a href="https://en.wikipedia.org/wiki/Sparse_matrix" class="external-link">sparse matrix</a>. The only important difference is that REDCap’s unspecified cells are interpreted as null/empty, while a sparse matrix’s unspecified cells are interpreted as zero.</p>
<blockquote>
<p>In the case of a sparse matrix, substantial memory requirement reductions can be realized by storing only the non-zero entries. Depending on the number and distribution of the non-zero entries, different data structures can be used and yield huge savings in memory when compared to the basic approach. The trade-off is that accessing the individual elements becomes more complex and additional structures are needed to be able to recover the original matrix unambiguously.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="retrieving-from-redcap">Retrieving from REDCap<a class="anchor" aria-label="anchor" href="#retrieving-from-redcap"></a>
</h2>
<p>Many new REDCap users will submit a single API call and unintentionally obtain something like Table 5; they then try to extract something resembling Tables 1, 3a, &amp; 3b. Although this can be successful, we strongly discourage it. The code is difficult to maintain and is not portable to REDCap projects with different instruments. (The code is really slow and ugly too.)</p>
<p>Our advice is to start before Table 5 is assembled –retrieve the information in a better way. Like other database systems, request the three tables separately from the server and then combine them on your desktop to fit your analyses if necessary.</p>
<p>Two approaches are appropriate for most scenarios: (a) a single call to REDCapTidieR’s <a href="https://chop-cgtdataops.github.io/REDCapTidieR/reference/read_redcap_tidy.html" class="external-link"><code>redcap_read_tidy()</code></a> or (b) multiple calls to REDCapR’s <a href="https://ouhscbbmc.github.io/REDCapR/reference/redcap_read.html"><code>redcap_read()</code></a>.</p>
<div class="section level3">
<h3 id="single-redcaptidier-calls">Single REDCapTidieR Calls<a class="anchor" aria-label="anchor" href="#single-redcaptidier-calls"></a>
</h3>
<p><a href="https://chop-cgtdataops.github.io/REDCapTidieR/" class="external-link">REDCapTidieR</a>’s initial motivation is to facilitate longitudinal analyses and promote <a href="https://r4ds.had.co.nz/tidy-data.html" class="external-link">tidy</a> data hygiene.</p>
<p>{Stephan Kadauke &amp; Richard Hanna, please represent your package as you wish. Tell me if I’ve positioned it differently than you would have.}</p>
</div>
<div class="section level3">
<h3 id="multiple-redcapr-calls">Multiple REDCapR Calls<a class="anchor" aria-label="anchor" href="#multiple-redcapr-calls"></a>
</h3>
<p>Under the hood, REDCapTidieR calls REDCapR multiple times.</p>
<p>{Will Beasley will write this section.}</p>
</div>
<div class="section level3">
<h3 id="choosing-between-the-approaches">Choosing between the Approaches<a class="anchor" aria-label="anchor" href="#choosing-between-the-approaches"></a>
</h3>
<p>We recommend calling <a href="https://chop-cgtdataops.github.io/REDCapTidieR/" class="external-link">REDCapTidieR</a> in many scenarios, such as:</p>
<ul>
<li>you are new to managing data with R, or</li>
<li>your analyses will require most of the dataset’s rows or columns, or</li>
<li>you’d benefit from some of the auxiliary information in <a href="https://chop-cgtdataops.github.io/REDCapTidieR/articles/REDCapTidieR.html#tidying-redcap-exports" class="external-link">REDCapTidieR’s supertibble</a>, such as instrument’s structure. <!--Future version may provide more information, like the column and row count of each table.-->
</li>
</ul>
<p>However we recommend calling <a href="https://ouhscbbmc.github.io/REDCapR/">REDCapR</a> in other scenarios. It could be worth calling REDCapR multiple times if:</p>
<ul>
<li>you are comfortable with managing data with R, or</li>
<li>your analyses require only a fraction of the data (such as (a) you need only the first event, or (b) the analyses don’t involve most of the instruments), or</li>
<li>you want to specify the variables’ data types with <a href="https://readr.tidyverse.org/reference/cols.html" class="external-link"><code>readr::cols()</code></a>.</li>
</ul>
<p>If in doubt, start with REDCapTidieR. Escalate to REDCapR if your download time is too long and might be decreased by reducing the information retrieved from the server and transported across the network.</p>
</div>
<div class="section level3">
<h3 id="escalating-to-redcapr">Escalating to REDCapR<a class="anchor" aria-label="anchor" href="#escalating-to-redcapr"></a>
</h3>
<p>Even if you think you’ll need REDCapR’s low-level control, consider starting with REDCapTidieR anyway. …particularly if you are unsure how to specify the grain of each table. The structure of REDCapTidieR’s tables easily compatible with conventional analyses. If you need the performance of REDCapR but are unsure how the tables should look, simply execute something like <code>REDCapTidieR::redcap_read_tidy(url, project_token)</code> and study its output. Then try to mimic it exactly with <code><a href="../reference/redcap_read.html">REDCapR::redcap_read()</a></code> calls.</p>
<p>Finally, cull unwanted cells using <code><a href="../reference/redcap_read.html">REDCapR::redcap_read()</a></code> parameters. These data points will not even leave the REDCap instance, which will improve performance. Some possible strategies include passing <a href="https://ouhscbbmc.github.io/REDCapR/reference/redcap_read.html#arguments">arguments</a> to</p>
<ul>
<li>
<code>forms</code>: this will retrieve only the specified instruments/forms. Beginners should start here. It is easy to conceptualize and usually has a big increase in speed for just a little development work.</li>
<li>
<code>events</code>: this will retrieve only the desired events within a longitudinal project. For instance if the analyses involve only the “intake” and “follow up #1” events, leave follow ups #2-10 on the server.</li>
<li>
<code>fields</code>: this is more granular than <code>forms</code>. It can be combined with calls to <code>forms</code>, such as passing <code>"bmi"</code> to fields and <code>c("blood_pressure", "laboratory")</code> to forms.</li>
<li>
<code>records</code>: in the example scenario, this will pluck individual patients and their associated events and repeating instances. To be useful in research, it’s usually combined with other REDCapR calls. See the <a href="https://ouhscbbmc.github.io/REDCapR/articles/BasicREDCapROperations.html#read-a-subset-of-records-conditioned-on-the-values-in-some-variables">Read a subset of records, conditioned on the values in some variables</a> section of REDCapR’s <a href="https://ouhscbbmc.github.io/REDCapR/articles/BasicREDCapROperations.html">Basic REDCapR Operations</a> vignette.</li>
<li>
<code>filter_logic</code>: this will leverage the observation values to limit the rows returned. Because the underlying table does not index the obs values, this will be less computationally efficient than the options above.</li>
<li>
<code>datetime_range_begin</code> &amp; <code>datetime_range_end</code>: this will return only the records that have been created or modified during the specified window.</li>
</ul>
<p>Note that the efficiency gain from moving from the block dataset to REDCapTidieR is different than the gain from moving from REDCapTidieR. When moving to from Table 5 to qqq (<em>via</em> REDCapTidieR), you are eliminating empty cells that will never contain worthwhile data. When moving to REDCapR, you are eliminating cells that contain data, but may not be relevant to your analysis (such as a patient’s name or the time a lab specimen was collected). {This paragraph needs work.}</p>
</div>
</div>
<div class="section level2">
<h2 id="advanced">Advanced<a class="anchor" aria-label="anchor" href="#advanced"></a>
</h2>
<div class="section level3">
<h3 id="longitudinal">Longitudinal<a class="anchor" aria-label="anchor" href="#longitudinal"></a>
</h3>
<p>{TODO: Generalize the argument to longitudinal events}</p>
<table class="table">
<thead><tr class="header">
<th><code>pt</code></th>
<th align="center">
<code>repeat</code><br><code>instrument</code>
</th>
<th align="right">
<code>repeat</code><br><code>instance</code>
</th>
<th align="right"><code>height</code></th>
<th align="right"><code>weight</code></th>
<th align="right"><code>bmi</code></th>
<th align="right"><code>sbp</code></th>
<th align="right"><code>dbp</code></th>
<th align="right"><code>lab</code></th>
<th align="right"><code>conc</code></th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td align="center">–</td>
<td align="right">–</td>
<td align="right">1.0</td>
<td align="right">11.0</td>
<td align="right">111.0</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
</tr>
<tr class="even">
<td>1</td>
<td align="center">blood_pressure</td>
<td align="right">1</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">1.1</td>
<td align="right">11.1</td>
<td align="right">–</td>
<td align="right">–</td>
</tr>
<tr class="odd">
<td>1</td>
<td align="center">blood_pressure</td>
<td align="right">2</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">1.2</td>
<td align="right">11.2</td>
<td align="right">–</td>
<td align="right">–</td>
</tr>
<tr class="even">
<td>1</td>
<td align="center">blood_pressure</td>
<td align="right">3</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">1.3</td>
<td align="right">11.3</td>
<td align="right">–</td>
<td align="right">–</td>
</tr>
<tr class="odd">
<td>1</td>
<td align="center">laboratory</td>
<td align="right">3</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">aa3</td>
<td align="right">1.3 ppm</td>
</tr>
<tr class="even">
<td>1</td>
<td align="center">laboratory</td>
<td align="right">4</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">aa4</td>
<td align="right">1.4 ppm</td>
</tr>
<tr class="odd">
<td>2</td>
<td align="center">–</td>
<td align="right">–</td>
<td align="right">2.0</td>
<td align="right">22.0</td>
<td align="right">222.0</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
</tr>
<tr class="even">
<td>2</td>
<td align="center">blood_pressure</td>
<td align="right">1</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">2.1</td>
<td align="right">22.1</td>
<td align="right">–</td>
<td align="right">–</td>
</tr>
<tr class="odd">
<td>2</td>
<td align="center">blood_pressure</td>
<td align="right">2</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">2.2</td>
<td align="right">22.2</td>
<td align="right">–</td>
<td align="right">–</td>
</tr>
<tr class="even">
<td>2</td>
<td align="center">blood_pressure</td>
<td align="right">3</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">2.3</td>
<td align="right">22.3</td>
<td align="right">–</td>
<td align="right">–</td>
</tr>
<tr class="odd">
<td>2</td>
<td align="center">laboratory</td>
<td align="right">3</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">bb3</td>
<td align="right">2.3 ppm</td>
</tr>
<tr class="even">
<td>2</td>
<td align="center">laboratory</td>
<td align="right">4</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">–</td>
<td align="right">bb4</td>
<td align="right">2.4 ppm</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="caching-results-to-improve-performance">Caching Results to Improve Performance<a class="anchor" aria-label="anchor" href="#caching-results-to-improve-performance"></a>
</h3>
<p>If escalating to REDCapR didn’t decrease the duration enough, consider the strategy of calling REDCap only once per day (with either package) and saving the results to a secured disk. This will be efficient when the analyses require a <em>large</em> dataset, but not a <em>recent</em> dataset.</p>
<p>In many retrospective projects, multiple analyses during the day can reuse the same dataset retrieved the night before (with a function like <a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link"><code>readr::write_rds()</code></a>). This has helped our complicated investigations when multiple statisticians frantically tackle overlapping aspects before a funder’s deadline.</p>
<p>Essentially you are transferring security responsibilities from REDCap to the file server. To balance its advantages, the approaches drawbacks include:</p>
<ul>
<li>extra effort is required to create, secure, and maintain a networked drive that is accessible to only authorized analysts. This will take 15-60 minutes, depending on your institution.</li>
<li>extra effort is required to create an automated program to retrieve and cache the dataset every night. See [CDS] for a head start.</li>
<li>REDCap’s logs will not inform a meaningful audit because no human is accessing the API. User access audits are now the responsibility of the file system.</li>
</ul>
</div>
<div class="section level3">
<h3 id="caching-results-for-other-languages">Caching Results for other Languages<a class="anchor" aria-label="anchor" href="#caching-results-for-other-languages"></a>
</h3>
<p>Packages for other programming languages have been developed that access REDCap’s API, such <a href="http://redcap-tools.github.io/PyCap/" class="external-link">PyCap</a> and <a href="https://github.com/iuredcap/phpcap" class="external-link">PhpCap</a>. Please see a more complete list at <a href="https://redcap-tools.github.io/projects" class="external-link uri">https://redcap-tools.github.io/projects</a>. The caching strategy described above may also benefit your investigation if:</p>
<ul>
<li><p>it uses a language like SAS that does not support packages. We strongly discourage deploying loose scripts that call the API. When something is fixed in the original script, it must be distributed by the developer to the ~50 client institutions, then it must by copied to the ~100 projects within each institution. In contrast, when a developer updates a package distributed through a repository like CRAN, the client needs to run only <a href="https://stat.ethz.ch/R-manual/R-devel/library/utils/html/update.packages.html" class="external-link"><code>base::update.packages()</code></a> once per machine to update all its packages –not just REDCap packages. Data scientists already do this regularly.</p></li>
<li><p>it uses a language like Julia that lacks a stable or updated package. The REDCap developers are always releasing useful features (<em>e.g.</em>, repeated measures) that improve the quality and efficiency of your research. Leverage them.</p></li>
<li><p>your investigation incorporates multiple programming languages and you would like the analysis team to use a consistent dataset. In this scenario, we recommend the code save the same R dataset in multiple file formats, such as a csv file and a feather file.</p></li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Will Beasley.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'd672935e2d904316d6ee40239317764e',
    indexName: 'redcapr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
