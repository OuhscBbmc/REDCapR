<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Writing to a REDCap Project • REDCapR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Writing to a REDCap Project">
<meta property="og:description" content="REDCapR">
<meta property="og:image" content="https://ouhscbbmc.github.io/REDCapR/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">REDCapR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.9005</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/OuhscBbmc/REDCapR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Writing to a REDCap Project</h1>
                        <h4 data-toc-skip class="author">Will Beasley <a href="https://www.ouhsc.edu/bbmc/team/" class="external-link">Biomedical &amp; Behavior
Methodology Core</a>, OUHSC Pediatrics;<br>Raymond Balise, University of
Miami School of Medicine</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/OuhscBbmc/REDCapR/blob/HEAD/vignettes/workflow-write.Rmd" class="external-link"><code>vignettes/workflow-write.Rmd</code></a></small>
      <div class="hidden name"><code>workflow-write.Rmd</code></div>

    </div>

    
    
<p>Writing data <em>to</em> REDCap is more difficult than reading data
<em>from</em> REDCap. When you read, you receive data in the structure
that the REDCap provides you. You have some control about the columns,
rows, and data types, but there is not a lot you have to be
concerned.</p>
<p>In contrast, the structure of the dataset you send to the REDCap
server must be precise. You need to pass special variables so that the
REDCap server understands the hierarchical structure of the data points.
This vignette walks you through that process.</p>
<p>If you are new to REDCap and its API, please first understand the
concepts described in these two <a href="https://ouhscbbmc.github.io/REDCapR/articles/">vignettes</a>:</p>
<ul>
<li><a href="https://ouhscbbmc.github.io/REDCapR/articles/workflow-read.html">Typical
REDCap Workflow for a Data Analyst</a></li>
<li><a href="https://ouhscbbmc.github.io/REDCapR/articles/longitudinal-and-repeating.html">Retrieving
Longitudinal and Repeating Structures</a></li>
</ul>
<div class="section level2">
<h2 id="part-1---intro">Part 1 - Intro<a class="anchor" aria-label="anchor" href="#part-1---intro"></a>
</h2>
<div class="section level3">
<h3 id="strategy">Strategy<a class="anchor" aria-label="anchor" href="#strategy"></a>
</h3>
<p>As described in the <a href="https://ouhscbbmc.github.io/REDCapR/articles/longitudinal-and-repeating.html">Retrieving
Longitudinal and Repeating Structures</a> vignette, the best way to read
and write data from projects with longitudinal/repeating elements is to
break up the “block matrix” dataset into individual datasets. Each
rectangle should have a coherent grain.</p>
<p>Following this strategy, we’ll write to the REDCap server in two
distinct steps:</p>
<ol style="list-style-type: decimal">
<li>Upload the patient-level instrument(s)</li>
<li>Upload the each repeating instrument separately.</li>
</ol>
<p>The actual upload phase is pretty straight-forward –it’s just a call
to [<code><a href="../reference/redcap_write.html">REDCapR::redcap_write()</a></code>]. Most of the vignette’s code
prepares the dataset so that the upload will run smoothly.</p>
</div>
<div class="section level3">
<h3 id="pre-requisites">Pre-requisites<a class="anchor" aria-label="anchor" href="#pre-requisites"></a>
</h3>
<p>See the <a href="https://ouhscbbmc.github.io/REDCapR/articles/workflow-read.html">Typical
REDCap Workflow for a Data Analyst</a> vignette and</p>
<ol style="list-style-type: decimal">
<li><a href="https://ouhscbbmc.github.io/REDCapR/articles/workflow-read.html#verify-redcapr-is-installed">Verify
REDCapR is installed</a></li>
<li><a href="https://ouhscbbmc.github.io/REDCapR/articles/workflow-read.html#verify-redcap-access">Verify
REDCap Access</a></li>
<li><a href="https://ouhscbbmc.github.io/REDCapR/articles/workflow-read.html#review-codebook">Review
Codebook</a></li>
</ol>
</div>
<div class="section level3">
<h3 id="retrieve-token">Retrieve Token<a class="anchor" aria-label="anchor" href="#retrieve-token"></a>
</h3>
<p>Please closely read the <a href="https://ouhscbbmc.github.io/REDCapR/articles/workflow-read.html#part-2---retrieve-protected-token">Retrieve
Protected Token</a> section, which has important security implications.
The current vignette imports a fake dataset into REDCap, and we’ll use a
token stored in a local file.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path_credential</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"misc/example.credentials"</span>, package <span class="op">=</span> <span class="st">"REDCapR"</span><span class="op">)</span></span>
<span><span class="va">credential</span>  <span class="op">&lt;-</span> <span class="fu">REDCapR</span><span class="fu">::</span><span class="fu"><a href="../reference/retrieve_credential.html">retrieve_credential_local</a></span><span class="op">(</span></span>
<span>  path_credential <span class="op">=</span> <span class="va">path_credential</span>,</span>
<span>  project_id      <span class="op">=</span> <span class="fl">3748</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">credential</span><span class="op">$</span><span class="va">redcap_uri</span>, <span class="va">credential</span><span class="op">$</span><span class="va">token</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "https://bbmc.ouhsc.edu/redcap/api/" "1CA2BDE35577F9E97E7BD4E6CB7C69B1"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="datasets-to-write-to-server">Datasets to Write to Server<a class="anchor" aria-label="anchor" href="#datasets-to-write-to-server"></a>
</h3>
<p>To keep this vignette focused on writing/importing/uploading to the
server, we’ll start with the data that needs to be written. These
example tables were prepared by <a href="https://github.com/RaymondBalise" class="external-link">Raymond Balise</a> for our 2023
<a href="https://events.linuxfoundation.org/r-medicine/" class="external-link">R/Medicine</a>
workshop, “Using REDCap and R to Rapidly Produce Biomedical
Publications”.</p>
<p>There are two tables, each with a different <a href="https://www.1keydata.com/datawarehousing/fact-table-granularity.html" class="external-link">granularity</a>:</p>
<ul>
<li>
<code>ds_patient</code>: each row represents one patient,</li>
<li>
<code>ds_daily</code>: each row represents one daily measurement per
patient.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds_patient</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"test-data/vignette-repeating-write/data-patient.rds"</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"REDCapR"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ds_patient</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 34 × 126</span></span></span>
<span><span class="co">#&gt;    id_code date       is_mobile is_mobile_where initials unique_initials</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 07      2016-07-05 0         <span style="color: #BB0000;">NA</span>              AB       AB             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 15      2016-09-09 0         <span style="color: #BB0000;">NA</span>              EF       EF             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 23      2016-11-16 0         <span style="color: #BB0000;">NA</span>              IJ       IJ             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 37      2016-10-04 0         <span style="color: #BB0000;">NA</span>              MN       MN             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 45      2016-02-23 0         <span style="color: #BB0000;">NA</span>              QR       QR             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 52      2016-12-25 1         5               UV       UV             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 65      2016-10-10 0         <span style="color: #BB0000;">NA</span>              YZ       YZ             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 70      2017-02-04 1         7               CD       CD             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 76      2017-04-17 1         1               GH       GH             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 80      2017-04-09 0         <span style="color: #BB0000;">NA</span>              KL       KL             </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 24 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 120 more variables: initials_mother &lt;chr&gt;, unique_initials_mother &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   birth_month &lt;chr&gt;, unique_birth_month &lt;chr&gt;, birth_year &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   simulated_dob &lt;chr&gt;, age_at_enrollment &lt;chr&gt;, race &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   unique_race &lt;chr&gt;, is_hispanic &lt;chr&gt;, sex_at_birth &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   unique_sex_at_birth &lt;chr&gt;, gender &lt;chr&gt;, unique_idcode &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   is_homeless &lt;chr&gt;, is_homeless_length &lt;dbl&gt;, is_homeless_units &lt;chr&gt;, …</span></span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds_daily</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"test-data/vignette-repeating-write/data-daily.rds"</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"REDCapR"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ds_daily</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 65 × 188</span></span></span>
<span><span class="co">#&gt;    id_code da_date    da_is_mobile da_is_mobile_where da_encounter_type</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 07      2016-07-05 0            <span style="color: #BB0000;">NA</span>                 1                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 07      2016-09-12 0            <span style="color: #BB0000;">NA</span>                 1                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 07      2016-11-09 0            <span style="color: #BB0000;">NA</span>                 1                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 07      2018-11-11 0            <span style="color: #BB0000;">NA</span>                 1                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 15      2016-09-09 0            <span style="color: #BB0000;">NA</span>                 1                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 15      2016-09-28 0            <span style="color: #BB0000;">NA</span>                 1                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 23      2016-11-16 0            <span style="color: #BB0000;">NA</span>                 1                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 23      2017-02-01 0            <span style="color: #BB0000;">NA</span>                 1                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 23      2017-06-27 0            <span style="color: #BB0000;">NA</span>                 1                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 23      2017-11-19 0            <span style="color: #BB0000;">NA</span>                 1                </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 55 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 183 more variables: da_visit_reason___1 &lt;lgl&gt;, da_visit_reason___2 &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   da_visit_reason___3 &lt;lgl&gt;, da_visit_reason___4 &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   da_visit_reason___5 &lt;lgl&gt;, da_visit_reason___6 &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   da_visit_reason___7 &lt;lgl&gt;, da_visit_reason___8 &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   da_visit_reason___9 &lt;lgl&gt;, da_visit_reason___10 &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   da_visit_reason___13 &lt;lgl&gt;, da_visit_reason___12 &lt;lgl&gt;, …</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="part-2---write-data-one-row-per-patient">Part 2 - Write Data: One row per patient<a class="anchor" aria-label="anchor" href="#part-2---write-data-one-row-per-patient"></a>
</h2>
<p>Besides the <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/data.frame.html" class="external-link"><code>data.frame</code></a>
to write to REDCap, the only required arguments of the <a href="https://ouhscbbmc.github.io/REDCapR/reference/redcap_write.html"><code>REDCapR::redcap_write()</code></a>
function are <code>redcap_uri</code> and <code>token</code>; both are
contained in the credential object created in the previous section.</p>
<p>As discussed in the <a href="https://ouhscbbmc.github.io/REDCapR/articles/TroubleshootingApiCalls.html#writing">Troubleshooting
vignette</a>, we recommend running these two preliminary checks before
trying to write the dataset to the server for the very first time.</p>
<div class="section level3">
<h3 id="prep-stoplight-fields">Prep: Stoplight Fields<a class="anchor" aria-label="anchor" href="#prep-stoplight-fields"></a>
</h3>
<p>If the REDCap project isn’t longitudinal and doesn’t have arms,
uploading a patient-level data.frame to REDCap doesn’t require adding
variables. However we typically populate the <code>*_complete</code>
variables to communicate the record’s status.</p>
<p>If the row is needs a human to add more values or inspect the
existing values consider <a href="https://ouhscbbmc.github.io/REDCapR/reference/constant.html">marking
the instrument</a> “incomplete” or “unverified”; the patient’s
instrument record will appear red or yellow in REDCap’s Record
Dashboard. Otherwise consider marking the instrument “complete” so it
will appear green.</p>
<p>With this example project, the only patient-level instrument is
“enrollment”, so the corresponding variable is
<code>enrollment_complete</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds_patient</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ds_patient</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    enrollment_complete   <span class="op">=</span> <span class="fu">REDCapR</span><span class="fu">::</span><span class="fu"><a href="../reference/constant.html">constant</a></span><span class="op">(</span><span class="st">"form_complete"</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="prep-redcaprvalidate_for_write">Prep: <code>REDCapR::validate_for_write()</code><a class="anchor" aria-label="anchor" href="#prep-redcaprvalidate_for_write"></a>
</h3>
<p><code><a href="../reference/validate.html">REDCapR::validate_for_write()</a></code> inspects a data frame to
anticipate potential problems before writing with REDCap’s API. A tibble
is returned, with one row per potential problem (and a suggestion how to
avoid it). Ideally an 0-row tibble is returned.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">REDCapR</span><span class="fu">::</span><span class="fu"><a href="../reference/validate.html">validate_for_write</a></span><span class="op">(</span><span class="va">ds_patient</span>, convert_logical_to_integer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 variables: field_name &lt;chr&gt;, field_index &lt;int&gt;, concern &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   suggestion &lt;chr&gt;</span></span></span></code></pre></div>
<p>If you encounter problems that can be checked with automation, please
tell us in <a href="https://github.com/OuhscBbmc/REDCapR/issues" class="external-link">an
issue</a>. We’ll work with you to incorporate the new check into
<code><a href="../reference/validate.html">REDCapR::validate_for_write()</a></code>.</p>
<p>When a dataset’s problems are caught before reaching the server, the
solutions are easier to identify and implement.</p>
</div>
<div class="section level3">
<h3 id="prep-write-small-subset-first">Prep: Write Small Subset First<a class="anchor" aria-label="anchor" href="#prep-write-small-subset-first"></a>
</h3>
<p>If this is your first time with a complicated project, consider
loading a small subset of rows and columns. In this case, we start with
only three columns and two rows.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds_patient</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>              <span class="co"># First three columns</span></span>
<span>    <span class="va">id_code</span>,</span>
<span>    <span class="va">date</span>,</span>
<span>    <span class="va">is_mobile</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span>        <span class="co"># First two rows</span></span>
<span>  <span class="fu">REDCapR</span><span class="fu">::</span><span class="fu"><a href="../reference/redcap_write.html">redcap_write</a></span><span class="op">(</span></span>
<span>    ds_to_write <span class="op">=</span> <span class="va">_</span>,</span>
<span>    redcap_uri  <span class="op">=</span> <span class="va">credential</span><span class="op">$</span><span class="va">redcap_uri</span>,</span>
<span>    token       <span class="op">=</span> <span class="va">credential</span><span class="op">$</span><span class="va">token</span>,</span>
<span>    convert_logical_to_integer <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Starting to update 2 records to be written at 2023-06-05 15:39:43.885731.</span></span>
<span><span class="co">#&gt; Writing batch 1 of 1, with indices 1 through 2.</span></span>
<span><span class="co">#&gt; 2 records were written to REDCap in 0.6 seconds.</span></span>
<span><span class="co">#&gt; $success</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $status_code</span></span>
<span><span class="co">#&gt; [1] "200"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $outcome_message</span></span>
<span><span class="co">#&gt; [1] "2 records were written to REDCap in 0.6 seconds."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $records_affected_count</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $affected_ids</span></span>
<span><span class="co">#&gt; [1] "07" "15"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $elapsed_seconds</span></span>
<span><span class="co">#&gt; [1] 1.10318</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="prep-recode-variables-where-necessary">Prep: Recode Variables where Necessary<a class="anchor" aria-label="anchor" href="#prep-recode-variables-where-necessary"></a>
</h3>
<p>Some variables in the data.frame might be represented differently
than in REDCap.</p>
<p>A common transformation is changing strings into the integers that
underlie radio buttons. Common approaches are <a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link"><code>dplyr::case_match()</code></a>
and using joining to lookup tables (if the mappings are expressed in a
csv). Here’s an in-line example of <code><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">dplyr::case_match()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds_patient</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ds_patient</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    race <span class="op">=</span> </span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span></span>
<span>        <span class="va">race</span>,</span>
<span>        <span class="st">"White"</span>                       <span class="op">~</span>  <span class="fl">1L</span>,</span>
<span>        <span class="st">"Black or African American"</span>   <span class="op">~</span>  <span class="fl">2L</span>,</span>
<span>        <span class="st">"Asian"</span>                       <span class="op">~</span>  <span class="fl">3L</span>,</span>
<span>        <span class="st">"Native American"</span>             <span class="op">~</span>  <span class="fl">4L</span>,</span>
<span>        <span class="st">"Pacific Islander"</span>            <span class="op">~</span>  <span class="fl">5L</span>,</span>
<span>        <span class="st">"Multiracial"</span>                 <span class="op">~</span>  <span class="fl">6L</span>,</span>
<span>        <span class="st">"Refused or don't know"</span>       <span class="op">~</span>  <span class="fl">7L</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="images/codebook-race.png" style="fig.width=600px"></p>
</div>
<div class="section level3">
<h3 id="write-entire-patient-level-table">Write Entire Patient-level Table<a class="anchor" aria-label="anchor" href="#write-entire-patient-level-table"></a>
</h3>
<p>If the small subset works, we usually jump ahead and try all columns
and rows.</p>
<p>If this larger table fails, split the difference between (a) the
smaller working example and (b) the larger failing example. See if this
middle point (that has fewer rows and/or columns than the failing point)
succeeds or fails. Then repeat. This “bisection” or “binary search” <a href="https://medium.com/codecastpublication/debugging-tools-and-techniques-binary-search-2da5bb4282c7" class="external-link">debugging
technique</a> is helpful in many areas of programming and statistical
modeling.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds_patient</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">REDCapR</span><span class="fu">::</span><span class="fu"><a href="../reference/redcap_write.html">redcap_write</a></span><span class="op">(</span></span>
<span>    ds_to_write <span class="op">=</span> <span class="va">_</span>,</span>
<span>    redcap_uri  <span class="op">=</span> <span class="va">credential</span><span class="op">$</span><span class="va">redcap_uri</span>,</span>
<span>    token       <span class="op">=</span> <span class="va">credential</span><span class="op">$</span><span class="va">token</span>,</span>
<span>    convert_logical_to_integer <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Starting to update 34 records to be written at 2023-06-05 15:39:45.251772.</span></span>
<span><span class="co">#&gt; Writing batch 1 of 1, with indices 1 through 34.</span></span>
<span><span class="co">#&gt; 34 records were written to REDCap in 1.0 seconds.</span></span>
<span><span class="co">#&gt; $success</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $status_code</span></span>
<span><span class="co">#&gt; [1] "200"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $outcome_message</span></span>
<span><span class="co">#&gt; [1] "34 records were written to REDCap in 1.0 seconds."</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $records_affected_count</span></span>
<span><span class="co">#&gt; [1] 34</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $affected_ids</span></span>
<span><span class="co">#&gt;  [1] "07"   "15"   "23"   "37"   "45"   "52"   "65"   "70"   "76"   "80"  </span></span>
<span><span class="co">#&gt; [11] "88"   "92"   "100"  "109"  "123"  "151"  "209"  "268"  "303"  "408" </span></span>
<span><span class="co">#&gt; [21] "515"  "650"  "1024" "1242" "2222" "3333" "4444" "4455" "5555" "6543"</span></span>
<span><span class="co">#&gt; [31] "7432" "8765" "8976" "8977"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $elapsed_seconds</span></span>
<span><span class="co">#&gt; [1] 1.690958</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="part-3---write-data-repeating-instrument">Part 3 - Write Data: Repeating Instrument<a class="anchor" aria-label="anchor" href="#part-3---write-data-repeating-instrument"></a>
</h2>
<div class="section level3">
<h3 id="add-plumbing-variables">Add Plumbing Variables<a class="anchor" aria-label="anchor" href="#add-plumbing-variables"></a>
</h3>
<p>As stated in the vignette’s intro, the structure of the dataset
uploaded to the server must be precise. When uploading repeating
instruments, there are several important columns:</p>
<ol style="list-style-type: decimal">
<li>
<code>record_id</code>: typically indicates the patient’s id. (This
field can be renamed for the project.)</li>
<li>
<code>redcap_event_name</code>: If the project is longitudinal or
has arms, this indicates the event. Otherwise, you don’t need to add
this variable.</li>
<li>
<code>redcap_repeat_instrument</code>: Indicates the instrument/form
that is repeating for these columns.</li>
<li>
<code>redcap_repeat_instance</code>: Typically a sequential positive
integer (<em>e.g.</em>, 1, 2, 3, …) indicating the order.</li>
</ol>
<p>The combination of these variables needs to be unique. Please read
the <a href="https://ouhscbbmc.github.io/REDCapR/articles/longitudinal-and-repeating.html">Retrieving
Longitudinal and Repeating Structures</a> vignette for details of these
variables and their meanings.</p>
<p>You need to pass specific variables so that the REDCap server
understands the hierarchical structure of the data points.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds_daily</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ds_daily</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id_code</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    redcap_repeat_instrument  <span class="op">=</span> <span class="st">"daily"</span>,</span>
<span>    redcap_repeat_instance    <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="va">da_date</span><span class="op">)</span>,</span>
<span>    daily_complete            <span class="op">=</span> <span class="fu">REDCapR</span><span class="fu">::</span><span class="fu"><a href="../reference/constant.html">constant</a></span><span class="op">(</span><span class="st">"form_complete"</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">id_code</span>,                        <span class="co"># Or `record_id`, if you didn't rename it</span></span>
<span>    <span class="co"># redcap_event_name,            # If the project is longitudinal or has arms</span></span>
<span>    <span class="va">redcap_repeat_instrument</span>,       <span class="co"># The name of the repeating instrument/form</span></span>
<span>    <span class="va">redcap_repeat_instance</span>,         <span class="co"># The sequence of the repeating instrument</span></span>
<span>    <span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>,       <span class="co"># All columns not explicitly passed to `dplyr::select()`</span></span>
<span>    <span class="va">daily_complete</span>,                 <span class="co"># Indicates incomplete, unverified, or complete</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Check for potential problems.  (Remember zero rows are good.)</span></span>
<span><span class="fu">REDCapR</span><span class="fu">::</span><span class="fu"><a href="../reference/validate.html">validate_for_write</a></span><span class="op">(</span><span class="va">ds_daily</span>, convert_logical_to_integer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 4</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 variables: field_name &lt;chr&gt;, field_index &lt;int&gt;, concern &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   suggestion &lt;chr&gt;</span></span></span>
<span></span>
<span><span class="va">ds_daily</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 65 × 191</span></span></span>
<span><span class="co">#&gt;    id_code redcap_repeat_instru…¹ redcap_repeat_instance da_date    da_is_mobile</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 07      daily                                       1 2016-07-05 0           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 07      daily                                       2 2016-09-12 0           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 07      daily                                       3 2016-11-09 0           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 07      daily                                       4 2018-11-11 0           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 15      daily                                       1 2016-09-09 0           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 15      daily                                       2 2016-09-28 0           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 23      daily                                       1 2016-11-16 0           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 23      daily                                       2 2017-02-01 0           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 23      daily                                       3 2017-06-27 0           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 23      daily                                       4 2017-11-19 0           </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 55 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated name: ¹​redcap_repeat_instrument</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 186 more variables: da_is_mobile_where &lt;chr&gt;, da_encounter_type &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   da_visit_reason___1 &lt;lgl&gt;, da_visit_reason___2 &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   da_visit_reason___3 &lt;lgl&gt;, da_visit_reason___4 &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   da_visit_reason___5 &lt;lgl&gt;, da_visit_reason___6 &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   da_visit_reason___7 &lt;lgl&gt;, da_visit_reason___8 &lt;lgl&gt;, …</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="part-4---next-steps">Part 4 - Next Steps<a class="anchor" aria-label="anchor" href="#part-4---next-steps"></a>
</h2>
<div class="section level3">
<h3 id="more-complexity">More Complexity<a class="anchor" aria-label="anchor" href="#more-complexity"></a>
</h3>
<p>This vignette required only two data.frames, but more complex
projects sometimes need more.<br>
For example, each repeating instrument should be its own data.frame and
writing step. Arms and longitudinal events need them too.</p>
</div>
<div class="section level3">
<h3 id="batching">Batching<a class="anchor" aria-label="anchor" href="#batching"></a>
</h3>
<p>By default, <code><a href="../reference/redcap_write.html">REDCapR::redcap_write()</a></code> requests datasets of
100 patients as a time, and stacks the resulting subsets together before
returning a data.frame. This can be adjusted to improve performance; the
‘Details’ section of <a href="https://ouhscbbmc.github.io/REDCapR/reference/redcap_write.html#details"><code>REDCapR::redcap_write()</code></a>
discusses the trade offs.</p>
<p>I usually shoot for ~10 seconds per batch.</p>
</div>
</div>
<div class="section level2">
<h2 id="notes">Notes<a class="anchor" aria-label="anchor" href="#notes"></a>
</h2>
<p>This vignette was originally designed for a 2023 R/Medicine REDCap
workshop with <a href="https://github.com/RaymondBalise" class="external-link">Raymond R.
Balise</a>, Belén Hervera, Daniel Maya, Anna Calderon, Tyler
Bartholomew, Stephan Kadauke, and João Pedro Carmezim Correia.</p>
<p>This work was made possible in part by the NIH grant <a href="https://taggs.hhs.gov/Detail/AwardDetail?arg_AwardNum=U54GM104938&amp;arg_ProgOfficeCode=127" class="external-link">U54GM104938</a>
to the <a href="http://osctr.ouhsc.edu" class="external-link">Oklahoma Shared Clinical and
Translational Resource)</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Will Beasley.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'd672935e2d904316d6ee40239317764e',
    indexName: 'redcapr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
