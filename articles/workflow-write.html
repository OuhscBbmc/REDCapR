<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Writing to a REDCap Project • REDCapR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Writing to a REDCap Project">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="inverse" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">REDCapR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/OuhscBbmc/REDCapR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Writing to a REDCap Project</h1>
                        <h4 data-toc-skip class="author">Will Beasley <a href="https://www.ouhsc.edu/bbmc/team/" class="external-link">Biomedical &amp; Behavior
Methodology Core</a>, OUHSC Pediatrics;;<br>Raymond Balise, University
of Miami School of Medicine<br>Stephan Kadauke, Children’s Hospital of
Philadelphia</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/OuhscBbmc/REDCapR/blob/main/vignettes/workflow-write.Rmd" class="external-link"><code>vignettes/workflow-write.Rmd</code></a></small>
      <div class="d-none name"><code>workflow-write.Rmd</code></div>
    </div>

    
    
<p>Writing data <em>to</em> REDCap is more difficult than reading data
<em>from</em> REDCap. When you read, you receive data in the structure
that the REDCap provides you. You have some control about the columns,
rows, and data types, but there is not a lot you have to be
concerned.</p>
<p>In contrast, the structure of the dataset you send to the REDCap
server must be precise. You need to pass special variables so that the
REDCap server understands the hierarchical structure of the data points.
This vignette walks you through that process.</p>
<p>If you are new to REDCap and its API, please first understand the
concepts described in these two <a href="https://ouhscbbmc.github.io/REDCapR/articles/">vignettes</a>:</p>
<ul>
<li><a href="https://ouhscbbmc.github.io/REDCapR/articles/workflow-read.html">Typical
REDCap Workflow for a Data Analyst</a></li>
<li><a href="https://ouhscbbmc.github.io/REDCapR/articles/longitudinal-and-repeating.html">Retrieving
Longitudinal and Repeating Structures</a></li>
</ul>
<div class="section level2">
<h2 id="part-1---intro">Part 1 - Intro<a class="anchor" aria-label="anchor" href="#part-1---intro"></a>
</h2>
<div class="section level3">
<h3 id="strategy">Strategy<a class="anchor" aria-label="anchor" href="#strategy"></a>
</h3>
<p>As described in the <a href="https://ouhscbbmc.github.io/REDCapR/articles/longitudinal-and-repeating.html">Retrieving
Longitudinal and Repeating Structures</a> vignette, the best way to read
and write data from projects with longitudinal/repeating elements is to
break up the “block matrix” dataset into individual datasets. Each
rectangle should have a coherent grain.</p>
<p>Following this strategy, we’ll write to the REDCap server in two
distinct steps:</p>
<ol style="list-style-type: decimal">
<li>Upload the patient-level instrument(s)</li>
<li>Upload the each repeating instrument separately.</li>
</ol>
<p>The actual upload phase is pretty straight-forward –it’s just a call
to <code><a href="../reference/redcap_write.html">REDCapR::redcap_write()</a></code>. Most of the vignette’s code
prepares the dataset so that the upload will run smoothly.</p>
</div>
<div class="section level3">
<h3 id="pre-requisites">Pre-requisites<a class="anchor" aria-label="anchor" href="#pre-requisites"></a>
</h3>
<p>See the <a href="https://ouhscbbmc.github.io/REDCapR/articles/workflow-read.html">Typical
REDCap Workflow for a Data Analyst</a> vignette and</p>
<ol style="list-style-type: decimal">
<li><a href="https://ouhscbbmc.github.io/REDCapR/articles/workflow-read.html#verify-redcapr-is-installed">Verify
REDCapR is installed</a></li>
<li><a href="https://ouhscbbmc.github.io/REDCapR/articles/workflow-read.html#verify-redcap-access">Verify
REDCap Access</a></li>
<li><a href="https://ouhscbbmc.github.io/REDCapR/articles/workflow-read.html#review-codebook">Review
Codebook</a></li>
</ol>
</div>
<div class="section level3">
<h3 id="retrieve-token">Retrieve Token<a class="anchor" aria-label="anchor" href="#retrieve-token"></a>
</h3>
<p>Please closely read the <a href="https://ouhscbbmc.github.io/REDCapR/articles/workflow-read.html#part-2---retrieve-protected-token">Retrieve
Protected Token</a> section, which has important security implications.
The current vignette imports a fake dataset into REDCap, and we’ll use a
token stored in a local file.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># retrieve-credential</span></span>
<span><span class="va">path_credential</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"misc/dev-2.credentials"</span>, package <span class="op">=</span> <span class="st">"REDCapR"</span><span class="op">)</span></span>
<span><span class="va">credential</span>  <span class="op">&lt;-</span> <span class="fu">REDCapR</span><span class="fu">::</span><span class="fu"><a href="../reference/retrieve_credential.html">retrieve_credential_local</a></span><span class="op">(</span></span>
<span>  path_credential <span class="op">=</span> <span class="va">path_credential</span>,</span>
<span>  project_id      <span class="op">=</span> <span class="fl">3748</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">credential</span><span class="op">$</span><span class="va">redcap_uri</span>, <span class="va">credential</span><span class="op">$</span><span class="va">token</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="datasets-to-write-to-server">Datasets to Write to Server<a class="anchor" aria-label="anchor" href="#datasets-to-write-to-server"></a>
</h3>
<p>To keep this vignette focused on writing/importing/uploading to the
server, we’ll start with the data that needs to be written. These
example tables were prepared by <a href="https://github.com/RaymondBalise" class="external-link">Raymond Balise</a> for our 2023
<a href="https://events.linuxfoundation.org/r-medicine/" class="external-link">R/Medicine</a>
workshop, “Using REDCap and R to Rapidly Produce Biomedical
Publications”.</p>
<p>There are two tables, each with a different <a href="https://www.1keydata.com/datawarehousing/fact-table-granularity.html" class="external-link">granularity</a>:</p>
<ul>
<li>
<code>ds_patient</code>: each row represents one patient,</li>
<li>
<code>ds_daily</code>: each row represents one daily measurement per
patient.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load-patient</span></span>
<span><span class="va">ds_patient</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"test-data/vignette-repeating-write/data-patient.rds"</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"REDCapR"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ds_patient</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load-repeating</span></span>
<span><span class="va">ds_daily</span> <span class="op">&lt;-</span></span>
<span>  <span class="st">"test-data/vignette-repeating-write/data-daily.rds"</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"REDCapR"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ds_daily</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="part-2---write-data-one-row-per-patient">Part 2 - Write Data: One row per patient<a class="anchor" aria-label="anchor" href="#part-2---write-data-one-row-per-patient"></a>
</h2>
<p>Besides the <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/data.frame.html" class="external-link"><code>data.frame</code></a>
to write to REDCap, the only required arguments of the <a href="https://ouhscbbmc.github.io/REDCapR/reference/redcap_write.html"><code>REDCapR::redcap_write()</code></a>
function are <code>redcap_uri</code> and <code>token</code>; both are
contained in the credential object created in the previous section.</p>
<p>As discussed in the <a href="https://ouhscbbmc.github.io/REDCapR/articles/TroubleshootingApiCalls.html#writing">Troubleshooting
vignette</a>, we recommend running these two preliminary checks before
trying to write the dataset to the server for the very first time.</p>
<div class="section level3">
<h3 id="prep-stoplight-fields">Prep: Stoplight Fields<a class="anchor" aria-label="anchor" href="#prep-stoplight-fields"></a>
</h3>
<p>If the REDCap project isn’t longitudinal and doesn’t have arms,
uploading a patient-level data.frame to REDCap doesn’t require adding
variables. However we typically populate the <code>*_complete</code>
variables to communicate the record’s status.</p>
<p>If the row is needs a human to add more values or inspect the
existing values consider <a href="https://ouhscbbmc.github.io/REDCapR/reference/constant.html">marking
the instrument</a> “incomplete” or “unverified”; the patient’s
instrument record will appear red or yellow in REDCap’s Record
Dashboard. Otherwise consider marking the instrument “complete” so it
will appear green.</p>
<p>With this example project, the only patient-level instrument is
“enrollment”, so the corresponding variable is
<code>enrollment_complete</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># patient-complete</span></span>
<span><span class="va">ds_patient</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ds_patient</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    enrollment_complete   <span class="op">=</span> <span class="fu">REDCapR</span><span class="fu">::</span><span class="fu"><a href="../reference/constant.html">constant</a></span><span class="op">(</span><span class="st">"form_complete"</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="prep-redcaprvalidate_for_write">Prep: <code>REDCapR::validate_for_write()</code><a class="anchor" aria-label="anchor" href="#prep-redcaprvalidate_for_write"></a>
</h3>
<p><code><a href="../reference/validate.html">REDCapR::validate_for_write()</a></code> inspects a data frame to
anticipate potential problems before writing with REDCap’s API. A tibble
is returned, with one row per potential problem (and a suggestion how to
avoid it). Ideally an 0-row tibble is returned.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">REDCapR</span><span class="fu">::</span><span class="fu"><a href="../reference/validate.html">validate_for_write</a></span><span class="op">(</span><span class="va">ds_patient</span>, convert_logical_to_integer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>If you encounter problems that can be checked with automation, please
tell us in <a href="https://github.com/OuhscBbmc/REDCapR/issues" class="external-link">an
issue</a>. We’ll work with you to incorporate the new check into
<code><a href="../reference/validate.html">REDCapR::validate_for_write()</a></code>.</p>
<p>When a dataset’s problems are caught before reaching the server, the
solutions are easier to identify and implement.</p>
</div>
<div class="section level3">
<h3 id="prep-write-small-subset-first">Prep: Write Small Subset First<a class="anchor" aria-label="anchor" href="#prep-write-small-subset-first"></a>
</h3>
<p>If this is your first time with a complicated project, consider
loading a small subset of rows and columns. In this case, we start with
only three columns and two rows.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># patient-subset</span></span>
<span><span class="va">ds_patient</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>              <span class="co"># First three columns</span></span>
<span>    <span class="va">id_code</span>,</span>
<span>    <span class="va">date</span>,</span>
<span>    <span class="va">is_mobile</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span>        <span class="co"># First two rows</span></span>
<span>  <span class="fu">REDCapR</span><span class="fu">::</span><span class="fu"><a href="../reference/redcap_write.html">redcap_write</a></span><span class="op">(</span></span>
<span>    ds_to_write <span class="op">=</span> <span class="va">_</span>,</span>
<span>    redcap_uri  <span class="op">=</span> <span class="va">credential</span><span class="op">$</span><span class="va">redcap_uri</span>,</span>
<span>    token       <span class="op">=</span> <span class="va">credential</span><span class="op">$</span><span class="va">token</span>,</span>
<span>    convert_logical_to_integer <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="prep-recode-variables-where-necessary">Prep: Recode Variables where Necessary<a class="anchor" aria-label="anchor" href="#prep-recode-variables-where-necessary"></a>
</h3>
<p>Some variables in the data.frame might be represented differently
than in REDCap.</p>
<p>A common transformation is changing strings into the integers that
underlie radio buttons. Common approaches are <a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link"><code>dplyr::case_match()</code></a>
and using joining to lookup tables (if the mappings are expressed in a
csv). Here’s an in-line example of <code><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">dplyr::case_match()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds_patient</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ds_patient</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    race <span class="op">=</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span></span>
<span>        <span class="va">race</span>,</span>
<span>        <span class="st">"White"</span>                       <span class="op">~</span>  <span class="fl">1L</span>,</span>
<span>        <span class="st">"Black or African American"</span>   <span class="op">~</span>  <span class="fl">2L</span>,</span>
<span>        <span class="st">"Asian"</span>                       <span class="op">~</span>  <span class="fl">3L</span>,</span>
<span>        <span class="st">"Native American"</span>             <span class="op">~</span>  <span class="fl">4L</span>,</span>
<span>        <span class="st">"Pacific Islander"</span>            <span class="op">~</span>  <span class="fl">5L</span>,</span>
<span>        <span class="st">"Multiracial"</span>                 <span class="op">~</span>  <span class="fl">6L</span>,</span>
<span>        <span class="st">"Refused or don't know"</span>       <span class="op">~</span>  <span class="fl">7L</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="images%2Fcodebook-race.png" style="fig.width=1200px"></p>
</div>
<div class="section level3">
<h3 id="write-entire-patient-level-table">Write Entire Patient-level Table<a class="anchor" aria-label="anchor" href="#write-entire-patient-level-table"></a>
</h3>
<p>If the small subset works, we usually jump ahead and try all columns
and rows.</p>
<p>If this larger table fails, split the difference between (a) the
smaller working example and (b) the larger failing example. See if this
middle point (that has fewer rows and/or columns than the failing point)
succeeds or fails. Then repeat. This “bisection” or “binary search” <a href="https://medium.com/codecastpublication/debugging-tools-and-techniques-binary-search-2da5bb4282c7" class="external-link">debugging
technique</a> is helpful in many areas of programming and statistical
modeling.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># patient-entire</span></span>
<span><span class="va">ds_patient</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">REDCapR</span><span class="fu">::</span><span class="fu"><a href="../reference/redcap_write.html">redcap_write</a></span><span class="op">(</span></span>
<span>    ds_to_write <span class="op">=</span> <span class="va">_</span>,</span>
<span>    redcap_uri  <span class="op">=</span> <span class="va">credential</span><span class="op">$</span><span class="va">redcap_uri</span>,</span>
<span>    token       <span class="op">=</span> <span class="va">credential</span><span class="op">$</span><span class="va">token</span>,</span>
<span>    convert_logical_to_integer <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="part-3---write-data-repeating-instrument">Part 3 - Write Data: Repeating Instrument<a class="anchor" aria-label="anchor" href="#part-3---write-data-repeating-instrument"></a>
</h2>
<div class="section level3">
<h3 id="add-plumbing-variables">Add Plumbing Variables<a class="anchor" aria-label="anchor" href="#add-plumbing-variables"></a>
</h3>
<p>As stated in the vignette’s intro, the structure of the dataset
uploaded to the server must be precise. When uploading repeating
instruments, there are several important columns:</p>
<ol style="list-style-type: decimal">
<li>
<code>record_id</code>: typically indicates the patient’s id. (This
field can be renamed for the project.)</li>
<li>
<code>redcap_event_name</code>: If the project is longitudinal or
has arms, this indicates the event. Otherwise, you don’t need to add
this variable.</li>
<li>
<code>redcap_repeat_instrument</code>: Indicates the instrument/form
that is repeating for these columns.</li>
<li>
<code>redcap_repeat_instance</code>: Typically a sequential positive
integer (<em>e.g.</em>, 1, 2, 3, …) indicating the order.</li>
</ol>
<p>The combination of these variables needs to be unique. Please read
the <a href="https://ouhscbbmc.github.io/REDCapR/articles/longitudinal-and-repeating.html">Retrieving
Longitudinal and Repeating Structures</a> vignette for details of these
variables and their meanings.</p>
<p>You need to pass specific variables so that the REDCap server
understands the hierarchical structure of the data points.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># repeat-plumbing</span></span>
<span><span class="va">ds_daily</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ds_daily</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id_code</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    redcap_repeat_instrument  <span class="op">=</span> <span class="st">"daily"</span>,</span>
<span>    redcap_repeat_instance    <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="va">da_date</span><span class="op">)</span>,</span>
<span>    daily_complete            <span class="op">=</span> <span class="fu">REDCapR</span><span class="fu">::</span><span class="fu"><a href="../reference/constant.html">constant</a></span><span class="op">(</span><span class="st">"form_complete"</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    <span class="va">id_code</span>,                        <span class="co"># Or `record_id`, if you didn't rename it</span></span>
<span>    <span class="co"># redcap_event_name,            # If the project is longitudinal or has arms</span></span>
<span>    <span class="va">redcap_repeat_instrument</span>,       <span class="co"># The name of the repeating instrument/form</span></span>
<span>    <span class="va">redcap_repeat_instance</span>,         <span class="co"># The sequence of the repeating instrument</span></span>
<span>    <span class="fu">tidyselect</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>,       <span class="co"># All columns not explicitly passed to `dplyr::select()`</span></span>
<span>    <span class="va">daily_complete</span>,                 <span class="co"># Indicates incomplete, unverified, or complete</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Check for potential problems.  (Remember zero rows are good.)</span></span>
<span><span class="fu">REDCapR</span><span class="fu">::</span><span class="fu"><a href="../reference/validate.html">validate_for_write</a></span><span class="op">(</span><span class="va">ds_daily</span>, convert_logical_to_integer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ds_daily</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="writing-repeating-instrument-variables">Writing Repeating Instrument Variables<a class="anchor" aria-label="anchor" href="#writing-repeating-instrument-variables"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># daily-entire</span></span>
<span><span class="va">ds_daily</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">REDCapR</span><span class="fu">::</span><span class="fu"><a href="../reference/redcap_write.html">redcap_write</a></span><span class="op">(</span></span>
<span>    ds_to_write <span class="op">=</span> <span class="va">_</span>,</span>
<span>    redcap_uri  <span class="op">=</span> <span class="va">credential</span><span class="op">$</span><span class="va">redcap_uri</span>,</span>
<span>    token       <span class="op">=</span> <span class="va">credential</span><span class="op">$</span><span class="va">token</span>,</span>
<span>    convert_logical_to_integer <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="part-4---next-steps">Part 4 - Next Steps<a class="anchor" aria-label="anchor" href="#part-4---next-steps"></a>
</h2>
<div class="section level3">
<h3 id="more-complexity">More Complexity<a class="anchor" aria-label="anchor" href="#more-complexity"></a>
</h3>
<p>This vignette required only two data.frames, but more complex
projects sometimes need more. For example, each repeating instrument
should be its own data.frame and writing step. Arms and longitudinal
events need to be considered too.</p>
</div>
<div class="section level3">
<h3 id="batching">Batching<a class="anchor" aria-label="anchor" href="#batching"></a>
</h3>
<p>By default, <code><a href="../reference/redcap_write.html">REDCapR::redcap_write()</a></code> requests datasets of
100 patients as a time, and stacks the resulting subsets together before
returning a data.frame. This can be adjusted to improve performance; the
‘Details’ section of <code><a href="../reference/redcap_write.html">REDCapR::redcap_write()</a></code> discusses the
trade offs.</p>
<p>I usually shoot for ~10 seconds per batch.</p>
</div>
<div class="section level3">
<h3 id="manual-vs-api">Manual vs API<a class="anchor" aria-label="anchor" href="#manual-vs-api"></a>
</h3>
<p>Manual downloading/uploading might make sense if you’re do the
operation only once. But when does it ever stop after the first
time?</p>
<p>If you have trouble uploading, consider adding a few fake patients
&amp; measurements and then download the csv. It might reveal something
you didn’t anticipate. But be aware that it will be in the block matrix
format (<em>i.e.</em>, everything jammed into one rectangle.)</p>
</div>
<div class="section level3">
<h3 id="redcaps-cdis">REDCap’s CDIS<a class="anchor" aria-label="anchor" href="#redcaps-cdis"></a>
</h3>
<p>The <a href="https://projectredcap.org/software/cdis/" class="external-link">Clinical Data
Interoperability Services</a> (CDIS) use <a href="https://www.hl7.org/fhir/overview.html" class="external-link">FHIR</a> to move data from
your institution’s <a href="https://www.healthit.gov/faq/what-are-differences-between-electronic-medical-records-electronic-health-records-and-personal" class="external-link">EMR/EHR</a>
(eg, Epic, Cerner) to REDCap. Research staff have control over which
patient records are selected or eligible. Conceptually it’s similar to
writing to REDCap’s with the API, but at much bigger scale.
Realistically, it takes months to get through your institution’s human
layers. Once established, a project would be populated with EMR data in
much less development time<br>
–assuming the desired data models corresponds with FHIR <a href="https://hl7.org/fhir/endpoint.html" class="external-link">endpoints</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="notes">Notes<a class="anchor" aria-label="anchor" href="#notes"></a>
</h2>
<p>This vignette was originally designed for the <a href="https://events.linuxfoundation.org/r-medicine/" class="external-link">2023
R/Medicine</a> workshop, <em>Using REDCap and R to Rapidly Produce
Biomedical Publications Cleaning Medical Data</em> with <a href="https://github.com/RaymondBalise" class="external-link">Raymond R. Balise</a>, Belén
Hervera, Daniel Maya, Anna Calderon, Tyler Bartholomew, Stephan Kadauke,
and João Pedro Carmezim Correia and the <a href="https://rconsortium.github.io/RMedicine_website/Program.html" class="external-link">2024
R/Medicine</a> workshop, <em>REDCap + R: Teaming Up in the
Tidyverse</em>, with Stephan Kadauke. The workshop slides are for <a href="https://github.com/RaymondBalise/r_med_redcap_2023_public" class="external-link">2023</a>
and <a href="https://github.com/skadauke/rmedicine_2024_redcap_r_workshop" class="external-link">2024</a>.</p>
<p>This work was made possible in part by the NIH grant <a href="https://taggs.hhs.gov/Detail/AwardDetail?arg_AwardNum=U54GM104938&amp;arg_ProgOfficeCode=127" class="external-link">U54GM104938</a>
to the <a href="http://osctr.ouhsc.edu" class="external-link">Oklahoma Shared Clinical and
Translational Resource)</a>.</p>
</div>
<div class="section level2">
<h2 id="session-information">Session Information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<p>For the sake of documentation and reproducibility, the current report
was rendered in the following environment. Click the line below to
expand.</p>
<details><summary>
Environment
</summary><pre><code><span><span class="co">#&gt; <span style="color: #00BBBB; font-weight: bold;">─ Session info ───────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt;  <span style="color: #555555; font-style: italic;">setting </span> <span style="color: #555555; font-style: italic;">value</span></span></span>
<span><span class="co">#&gt;  version  R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">#&gt;  os       macOS Sonoma 14.7</span></span>
<span><span class="co">#&gt;  system   aarch64, darwin20</span></span>
<span><span class="co">#&gt;  ui       X11</span></span>
<span><span class="co">#&gt;  language en</span></span>
<span><span class="co">#&gt;  collate  en_US.UTF-8</span></span>
<span><span class="co">#&gt;  ctype    en_US.UTF-8</span></span>
<span><span class="co">#&gt;  tz       UTC</span></span>
<span><span class="co">#&gt;  date     2024-10-19</span></span>
<span><span class="co">#&gt;  pandoc   3.1.11 @ /usr/local/bin/ (via rmarkdown)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB; font-weight: bold;">─ Packages ───────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt;  <span style="color: #555555; font-style: italic;">package    </span> <span style="color: #555555; font-style: italic;">*</span> <span style="color: #555555; font-style: italic;">version</span> <span style="color: #555555; font-style: italic;">date (UTC)</span> <span style="color: #555555; font-style: italic;">lib</span> <span style="color: #555555; font-style: italic;">source</span></span></span>
<span><span class="co">#&gt;  bslib         0.8.0   <span style="color: #555555;">2024-07-29</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  cachem        1.1.0   <span style="color: #555555;">2024-05-16</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  cli           3.6.3   <span style="color: #555555;">2024-06-21</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  desc          1.4.3   <span style="color: #555555;">2023-12-10</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  digest        0.6.37  <span style="color: #555555;">2024-08-19</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.1)</span></span></span>
<span><span class="co">#&gt;  evaluate      1.0.1   <span style="color: #555555;">2024-10-10</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.1)</span></span></span>
<span><span class="co">#&gt;  fastmap       1.2.0   <span style="color: #555555;">2024-05-15</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  fs            1.6.4   <span style="color: #555555;">2024-04-25</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  highr         0.11    <span style="color: #555555;">2024-05-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  htmltools     0.5.8.1 <span style="color: #555555;">2024-04-04</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  jquerylib     0.1.4   <span style="color: #555555;">2021-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  jsonlite      1.8.9   <span style="color: #555555;">2024-09-20</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.1)</span></span></span>
<span><span class="co">#&gt;  knitr         1.48    <span style="color: #555555;">2024-07-07</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  lifecycle     1.0.4   <span style="color: #555555;">2023-11-07</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  pkgdown       2.1.1   <span style="color: #555555;">2024-09-17</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.1)</span></span></span>
<span><span class="co">#&gt;  R6            2.5.1   <span style="color: #555555;">2021-08-19</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  ragg          1.3.3   <span style="color: #555555;">2024-09-11</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.1)</span></span></span>
<span><span class="co">#&gt;  rlang         1.1.4   <span style="color: #555555;">2024-06-04</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  rmarkdown     2.28    <span style="color: #555555;">2024-08-17</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  sass          0.4.9   <span style="color: #555555;">2024-03-15</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  sessioninfo   1.2.2   <span style="color: #555555;">2021-12-06</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  systemfonts   1.1.0   <span style="color: #555555;">2024-05-15</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  textshaping   0.4.0   <span style="color: #555555;">2024-05-24</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt;  xfun          0.48    <span style="color: #555555;">2024-10-03</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.1)</span></span></span>
<span><span class="co">#&gt;  yaml          2.3.10  <span style="color: #555555;">2024-07-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">CRAN (R 4.4.0)</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [1] /Users/runner/work/_temp/Library</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [2] /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB; font-weight: bold;">──────────────────────────────────────────────────────────────────────────────</span></span></span></code></pre>
</details>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Will Beasley.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
